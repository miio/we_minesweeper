class AddPartitionPanelsOnlyMysql < ActiveRecord::Migration
  def change
    add_index :panels, :id
    # ADD PRIMARY
    execute "ALTER TABLE panels DROP PRIMARY KEY"
    execute "ALTER TABLE panels add primary key(id, created_at)"
    remove_index :panels, :id

    # ADD PARTITION
    execute "
    ALTER TABLE panels
    PARTITION BY RANGE (TO_DAYS(created_at))
    (
      PARTITION p20120101 VALUES LESS THAN (TO_DAYS('2012-01-01')) ENGINE = InnoDB,
      PARTITION p20120201 VALUES LESS THAN (TO_DAYS('2012-02-01')) ENGINE = InnoDB,
      PARTITION p20120301 VALUES LESS THAN (TO_DAYS('2012-03-01')) ENGINE = InnoDB,
      PARTITION p20120401 VALUES LESS THAN (TO_DAYS('2012-04-01')) ENGINE = InnoDB,
      PARTITION p20120501 VALUES LESS THAN (TO_DAYS('2012-05-01')) ENGINE = InnoDB,
      PARTITION p20120601 VALUES LESS THAN (TO_DAYS('2012-06-01')) ENGINE = InnoDB,
      PARTITION p20120701 VALUES LESS THAN (TO_DAYS('2012-07-01')) ENGINE = InnoDB,
      PARTITION p20120801 VALUES LESS THAN (TO_DAYS('2012-08-01')) ENGINE = InnoDB,
      PARTITION p20120901 VALUES LESS THAN (TO_DAYS('2012-09-01')) ENGINE = InnoDB,
      PARTITION p20121001 VALUES LESS THAN (TO_DAYS('2012-10-01')) ENGINE = InnoDB,
      PARTITION p20121101 VALUES LESS THAN (TO_DAYS('2012-11-01')) ENGINE = InnoDB,
      PARTITION p20121201 VALUES LESS THAN (TO_DAYS('2012-12-01')) ENGINE = InnoDB,
      PARTITION p20130101 VALUES LESS THAN (TO_DAYS('2013-01-01')) ENGINE = InnoDB,
      PARTITION p20130201 VALUES LESS THAN (TO_DAYS('2013-02-01')) ENGINE = InnoDB,
      PARTITION p20130301 VALUES LESS THAN (TO_DAYS('2013-03-01')) ENGINE = InnoDB,
      PARTITION p20130401 VALUES LESS THAN (TO_DAYS('2013-04-01')) ENGINE = InnoDB,
      PARTITION p20130501 VALUES LESS THAN (TO_DAYS('2013-05-01')) ENGINE = InnoDB,
      PARTITION p20130601 VALUES LESS THAN (TO_DAYS('2013-06-01')) ENGINE = InnoDB,
      PARTITION p20130701 VALUES LESS THAN (TO_DAYS('2013-07-01')) ENGINE = InnoDB,
      PARTITION p20130801 VALUES LESS THAN (TO_DAYS('2013-08-01')) ENGINE = InnoDB,
      PARTITION p20130901 VALUES LESS THAN (TO_DAYS('2013-09-01')) ENGINE = InnoDB,
      PARTITION p20131001 VALUES LESS THAN (TO_DAYS('2013-10-01')) ENGINE = InnoDB,
      PARTITION p20131101 VALUES LESS THAN (TO_DAYS('2013-11-01')) ENGINE = InnoDB,
      PARTITION p20131201 VALUES LESS THAN (TO_DAYS('2013-12-01')) ENGINE = InnoDB,
      PARTITION p20140101 VALUES LESS THAN (TO_DAYS('2014-01-01')) ENGINE = InnoDB,
      PARTITION p20140201 VALUES LESS THAN (TO_DAYS('2014-02-01')) ENGINE = InnoDB,
      PARTITION p20140301 VALUES LESS THAN (TO_DAYS('2014-03-01')) ENGINE = InnoDB,
      PARTITION p20140401 VALUES LESS THAN (TO_DAYS('2014-04-01')) ENGINE = InnoDB,
      PARTITION p20140501 VALUES LESS THAN (TO_DAYS('2014-05-01')) ENGINE = InnoDB,
      PARTITION p20140601 VALUES LESS THAN (TO_DAYS('2014-06-01')) ENGINE = InnoDB,
      PARTITION p20140701 VALUES LESS THAN (TO_DAYS('2014-07-01')) ENGINE = InnoDB,
      PARTITION p20140801 VALUES LESS THAN (TO_DAYS('2014-08-01')) ENGINE = InnoDB,
      PARTITION p20140901 VALUES LESS THAN (TO_DAYS('2014-09-01')) ENGINE = InnoDB,
      PARTITION p20141001 VALUES LESS THAN (TO_DAYS('2014-10-01')) ENGINE = InnoDB,
      PARTITION p20141101 VALUES LESS THAN (TO_DAYS('2014-11-01')) ENGINE = InnoDB,
      PARTITION p20141201 VALUES LESS THAN (TO_DAYS('2014-12-01')) ENGINE = InnoDB,
      PARTITION p20150101 VALUES LESS THAN (TO_DAYS('2015-01-01')) ENGINE = InnoDB,
      PARTITION p20150201 VALUES LESS THAN (TO_DAYS('2015-02-01')) ENGINE = InnoDB,
      PARTITION p20150301 VALUES LESS THAN (TO_DAYS('2015-03-01')) ENGINE = InnoDB,
      PARTITION p20150401 VALUES LESS THAN (TO_DAYS('2015-04-01')) ENGINE = InnoDB,
      PARTITION p20150501 VALUES LESS THAN (TO_DAYS('2015-05-01')) ENGINE = InnoDB,
      PARTITION p20150601 VALUES LESS THAN (TO_DAYS('2015-06-01')) ENGINE = InnoDB,
      PARTITION p20150701 VALUES LESS THAN (TO_DAYS('2015-07-01')) ENGINE = InnoDB,
      PARTITION p20150801 VALUES LESS THAN (TO_DAYS('2015-08-01')) ENGINE = InnoDB,
      PARTITION p20150901 VALUES LESS THAN (TO_DAYS('2015-09-01')) ENGINE = InnoDB,
      PARTITION p20151001 VALUES LESS THAN (TO_DAYS('2015-10-01')) ENGINE = InnoDB,
      PARTITION p20151101 VALUES LESS THAN (TO_DAYS('2015-11-01')) ENGINE = InnoDB,
      PARTITION p20151201 VALUES LESS THAN (TO_DAYS('2015-12-01')) ENGINE = InnoDB,
      PARTITION pmax VALUES LESS THAN MAXVALUE ENGINE = InnoDB
    );
    "
  end
end
